<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="记录在工作中遇到的各种技术问题">
<meta property="og:type" content="website">
<meta property="og:title" content="带刀大哥">
<meta property="og:url" content="http://yoursite.com/page/5/index.html">
<meta property="og:site_name" content="带刀大哥">
<meta property="og:description" content="记录在工作中遇到的各种技术问题">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="带刀大哥">
<meta name="twitter:description" content="记录在工作中遇到的各种技术问题">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/5/"/>





  <title> 带刀大哥 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">带刀大哥</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">DavikChen的技术博客</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/03/29/Android实现网络多线程文件下载/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="DavikChen">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/davikchen_pic.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="带刀大哥">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="带刀大哥" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/03/29/Android实现网络多线程文件下载/" itemprop="url">
                  Android实现网络多线程文件下载
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-03-29T16:02:11+08:00">
                2017-03-29
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <a href="/2017/03/29/Android实现网络多线程文件下载/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/03/29/Android实现网络多线程文件下载/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Android实现网络多线程文件下载"><a href="#Android实现网络多线程文件下载" class="headerlink" title="Android实现网络多线程文件下载"></a>Android实现网络多线程文件下载</h2><p>这里主要用到 RandomAccessFile 类进行分隔下载</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">// 计算每条线程下载的数据长度  </div><div class="line">blockSize = (fileSize % threadNum) == 0 ? fileSize / threadNum : fileSize / threadNum + 1;  </div><div class="line">举例:线程下载的数据长度   (10%3 == 0 ？ 10/3:10/3+1) ,第1，2个线程下载长度是4M，第三个线程下载长度为2M</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">RandomAccessFile  raf = new RandomAccessFile(file, &quot;rwd&quot;);  </div><div class="line">raf.seek(startPos); // 移动到当前线程开始下载的位置</div></pre></td></tr></table></figure>
<p>转自:<a href="http://blog.csdn.net/mad1989/article/details/38421465" target="_blank" rel="external">http://blog.csdn.net/mad1989/article/details/38421465</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/03/29/运行时权限处理完全解析/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="DavikChen">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/davikchen_pic.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="带刀大哥">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="带刀大哥" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/03/29/运行时权限处理完全解析/" itemprop="url">
                  android6.0运行时权限处理完全解析
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-03-29T15:30:48+08:00">
                2017-03-29
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <a href="/2017/03/29/运行时权限处理完全解析/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/03/29/运行时权限处理完全解析/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="一、概述"><a href="#一、概述" class="headerlink" title="一、概述"></a>一、概述</h3><p>随着Android 6.0发布以及普及，我们开发者所要应对的主要就是新版本SDK带来的一些变化，首先关注的就是权限机制的变化。对于6.0的几个主要的变化，查看查看官网的这篇文章<a href="http://developer.android.com/intl/zh-cn/about/versions/marshmallow/android-6.0-changes.html，其中当然包含Runtime" target="_blank" rel="external">http://developer.android.com/intl/zh-cn/about/versions/marshmallow/android-6.0-changes.html，其中当然包含Runtime</a> Permissions。</p>
<p>ok，本篇文章目的之一就是对运行时权限处理的一个介绍，以及对目前权限相关的库的一些了解。</p>
<p>当然非常推荐阅读官网权限相关文章：</p>
<p>Working with System Permissions<br>Permissions Best Practices<br>本文也是在上述文章基础上理解、实验以及封装。</p>
<h3 id="二、运行时权限的变化及特点"><a href="#二、运行时权限的变化及特点" class="headerlink" title="二、运行时权限的变化及特点"></a>二、运行时权限的变化及特点</h3><p>对于6.0以下的权限及在安装的时候，根据权限声明产生一个权限列表，用户只有在同意之后才能完成app的安装，造成了我们想要使用某个app，就要默默忍受其一些不必要的权限（比如是个app都要访问通讯录、短信等）。而在6.0以后，我们可以直接安装，当app需要我们授予不恰当的权限的时候，我们可以予以拒绝（比如：单机的象棋对战，请求访问任何权限，我都是不同意的）。当然你也可以在设置界面对每个app的权限进行查看，以及对单个权限进行授权或者解除授权。</p>
<p>新的权限机制更好的保护了用户的隐私，Google将权限分为两类，一类是Normal Permissions，这类权限一般不涉及用户隐私，是不需要用户进行授权的，比如手机震动、访问网络等；另一类是Dangerous Permission，一般是涉及到用户隐私的，需要用户进行授权，比如读取sdcard、访问通讯录等。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div></pre></td><td class="code"><pre><div class="line">Normal Permissions如下</div><div class="line">ACCESS_LOCATION_EXTRA_COMMANDS</div><div class="line">ACCESS_NETWORK_STATE</div><div class="line">ACCESS_NOTIFICATION_POLICY</div><div class="line">ACCESS_WIFI_STATE</div><div class="line">BLUETOOTH</div><div class="line">BLUETOOTH_ADMIN</div><div class="line">BROADCAST_STICKY</div><div class="line">CHANGE_NETWORK_STATE</div><div class="line">CHANGE_WIFI_MULTICAST_STATE</div><div class="line">CHANGE_WIFI_STATE</div><div class="line">DISABLE_KEYGUARD</div><div class="line">EXPAND_STATUS_BAR</div><div class="line">GET_PACKAGE_SIZE</div><div class="line">INSTALL_SHORTCUT</div><div class="line">INTERNET</div><div class="line">KILL_BACKGROUND_PROCESSES</div><div class="line">MODIFY_AUDIO_SETTINGS</div><div class="line">NFC</div><div class="line">READ_SYNC_SETTINGS</div><div class="line">READ_SYNC_STATS</div><div class="line">RECEIVE_BOOT_COMPLETED</div><div class="line">REORDER_TASKS</div><div class="line">REQUEST_INSTALL_PACKAGES</div><div class="line">SET_ALARM</div><div class="line">SET_TIME_ZONE</div><div class="line">SET_WALLPAPER</div><div class="line">SET_WALLPAPER_HINTS</div><div class="line">TRANSMIT_IR</div><div class="line">UNINSTALL_SHORTCUT</div><div class="line">USE_FINGERPRINT</div><div class="line">VIBRATE</div><div class="line">WAKE_LOCK</div><div class="line">WRITE_SYNC_SETTINGS</div><div class="line"></div><div class="line">Dangerous Permissions:</div><div class="line">group:android.permission-group.CONTACTS</div><div class="line">  permission:android.permission.WRITE_CONTACTS</div><div class="line">  permission:android.permission.GET_ACCOUNTS</div><div class="line">  permission:android.permission.READ_CONTACTS</div><div class="line"></div><div class="line">group:android.permission-group.PHONE</div><div class="line">  permission:android.permission.READ_CALL_LOG</div><div class="line">  permission:android.permission.READ_PHONE_STATE</div><div class="line">  permission:android.permission.CALL_PHONE</div><div class="line">  permission:android.permission.WRITE_CALL_LOG</div><div class="line">  permission:android.permission.USE_SIP</div><div class="line">  permission:android.permission.PROCESS_OUTGOING_CALLS</div><div class="line">  permission:com.android.voicemail.permission.ADD_VOICEMAIL</div><div class="line"></div><div class="line">group:android.permission-group.CALENDAR</div><div class="line">  permission:android.permission.READ_CALENDAR</div><div class="line">  permission:android.permission.WRITE_CALENDAR</div><div class="line"></div><div class="line">group:android.permission-group.CAMERA</div><div class="line">  permission:android.permission.CAMERA</div><div class="line"></div><div class="line">group:android.permission-group.SENSORS</div><div class="line">  permission:android.permission.BODY_SENSORS</div><div class="line"></div><div class="line">group:android.permission-group.LOCATION</div><div class="line">  permission:android.permission.ACCESS_FINE_LOCATION</div><div class="line">  permission:android.permission.ACCESS_COARSE_LOCATION</div><div class="line"></div><div class="line">group:android.permission-group.STORAGE</div><div class="line">  permission:android.permission.READ_EXTERNAL_STORAGE</div><div class="line">  permission:android.permission.WRITE_EXTERNAL_STORAGE</div><div class="line"></div><div class="line">group:android.permission-group.MICROPHONE</div><div class="line">  permission:android.permission.RECORD_AUDIO</div><div class="line"></div><div class="line">group:android.permission-group.SMS</div><div class="line">  permission:android.permission.READ_SMS</div><div class="line">  permission:android.permission.RECEIVE_WAP_PUSH</div><div class="line">  permission:android.permission.RECEIVE_MMS</div><div class="line">  permission:android.permission.RECEIVE_SMS</div><div class="line">  permission:android.permission.SEND_SMS</div><div class="line">  permission:android.permission.READ_CELL_BROADCASTS</div></pre></td></tr></table></figure>
<p>看到上面的dangerous permissions，会发现一个问题，好像危险权限都是一组一组的，恩，没错，的确是这样的，</p>
<p>那么有个问题：分组对我们的权限机制有什么影响吗？</p>
<p>的确是有影响的，如果app运行在Android 6.x的机器上，对于授权机制是这样的。如果你申请某个危险的权限，假设你的app早已被用户授权了同一组的某个危险权限，那么系统会立即授权，而不需要用户去点击授权。比如你的app对READ_CONTACTS已经授权了，当你的app申请WRITE_CONTACTS时，系统会直接授权通过。此外，对于申请时弹出的dialog上面的文本说明也是对整个权限组的说明，而不是单个权限（ps:这个dialog是不能进行定制的）。</p>
<p>不过需要注意的是，不要对权限组过多的依赖，尽可能对每个危险权限都进行正常流程的申请，因为在后期的版本中这个权限组可能会产生变化。</p>
<p>三、相关API</p>
<p>好在运行时相关的API也比较简单，所以适配起来并不会非常痛苦。</p>
<p>API的讲解就跟着申请权限步骤一起了：</p>
<p>在AndroidManifest文件中添加需要的权限。</p>
<p>这个步骤和我们之前的开发并没有什么变化，试图去申请一个没有声明的权限可能会导致程序崩溃。</p>
<p>检查权限</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">if (ContextCompat.checkSelfPermission(thisActivity,</div><div class="line">                Manifest.permission.READ_CONTACTS)</div><div class="line">        != PackageManager.PERMISSION_GRANTED) &#123;</div><div class="line">&#125;else&#123;</div><div class="line">    //</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这里涉及到一个API，ContextCompat.checkSelfPermission，主要用于检测某个权限是否已经被授予，方法返回值为PackageManager.PERMISSION_DENIED或者PackageManager.PERMISSION_GRANTED。当返回DENIED就需要进行申请授权了。</p>
<p>申请授权</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ActivityCompat.requestPermissions(thisActivity,</div><div class="line">               new String[]&#123;Manifest.permission.READ_CONTACTS&#125;,</div><div class="line">               MY_PERMISSIONS_REQUEST_READ_CONTACTS);</div></pre></td></tr></table></figure>
<p>该方法是异步的，第一个参数是Context；第二个参数是需要申请的权限的字符串数组；第三个参数为requestCode，主要用于回调的时候检测。可以从方法名requestPermissions以及第二个参数看出，是支持一次性申请多个权限的，系统会通过对话框逐一询问用户是否授权。</p>
<p>处理权限申请回调</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">@Override</div><div class="line">public void onRequestPermissionsResult(int requestCode,</div><div class="line">        String permissions[], int[] grantResults) &#123;</div><div class="line">    switch (requestCode) &#123;</div><div class="line">        case MY_PERMISSIONS_REQUEST_READ_CONTACTS: &#123;</div><div class="line">            // If request is cancelled, the result arrays are empty.</div><div class="line">            if (grantResults.length &gt; 0</div><div class="line">                &amp;&amp; grantResults[0] == PackageManager.PERMISSION_GRANTED) &#123;</div><div class="line"></div><div class="line">                // permission was granted, yay! Do the</div><div class="line">                // contacts-related task you need to do.</div><div class="line"></div><div class="line">            &#125; else &#123;</div><div class="line"></div><div class="line">                // permission denied, boo! Disable the</div><div class="line">                // functionality that depends on this permission.</div><div class="line">            &#125;</div><div class="line">            return;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ok，对于权限的申请结果，首先验证requestCode定位到你的申请，然后验证grantResults对应于申请的结果，这里的数组对应于申请时的第二个权限字符串数组。如果你同时申请两个权限，那么grantResults的length就为2，分别记录你两个权限的申请结果。如果申请成功，就可以做你的事情了~</p>
<p>当然，到此我们的权限申请的不走，基本介绍就如上述。不过还有个API值得提一下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">// Should we show an explanation?</div><div class="line">if (ActivityCompat.shouldShowRequestPermissionRationale(thisActivity,</div><div class="line">        Manifest.permission.READ_CONTACTS)) </div><div class="line">    // Show an expanation to the user *asynchronously* -- don&apos;t block</div><div class="line">    // this thread waiting for the user&apos;s response! After the user</div><div class="line">    // sees the explanation, try again to request the permission.</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这个API主要用于给用户一个申请权限的解释，该方法只有在用户在上一次已经拒绝过你的这个权限申请。也就是说，用户已经拒绝一次了，你又弹个授权框，你需要给用户一个解释，为什么要授权，则使用该方法。</p>
<p>那么将上述几个步骤结合到一起就是：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">// Here, thisActivity is the current activity</div><div class="line">if (ContextCompat.checkSelfPermission(thisActivity,</div><div class="line">                Manifest.permission.READ_CONTACTS)</div><div class="line">        != PackageManager.PERMISSION_GRANTED) &#123;</div><div class="line"></div><div class="line">    // Should we show an explanation?</div><div class="line">    if (ActivityCompat.shouldShowRequestPermissionRationale(thisActivity,</div><div class="line">            Manifest.permission.READ_CONTACTS)) &#123;</div><div class="line"></div><div class="line">        // Show an expanation to the user *asynchronously* -- don&apos;t block</div><div class="line">        // this thread waiting for the user&apos;s response! After the user</div><div class="line">        // sees the explanation, try again to request the permission.</div><div class="line"></div><div class="line">    &#125; else &#123;</div><div class="line"></div><div class="line">        // No explanation needed, we can request the permission.</div><div class="line"></div><div class="line">        ActivityCompat.requestPermissions(thisActivity,</div><div class="line">                new String[]&#123;Manifest.permission.READ_CONTACTS&#125;,</div><div class="line">                MY_PERMISSIONS_REQUEST_READ_CONTACTS);</div><div class="line"></div><div class="line">        // MY_PERMISSIONS_REQUEST_READ_CONTACTS is an</div><div class="line">        // app-defined int constant. The callback method gets the</div><div class="line">        // result of the request.</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="四、封装"><a href="#四、封装" class="headerlink" title="四、封装"></a>四、封装</h3><p>github :<br><a href="https://github.com/lovedise/PermissionGen" target="_blank" rel="external">https://github.com/lovedise/PermissionGen</a><br><a href="https://github.com/hongyangAndroid/MPermissions" target="_blank" rel="external">https://github.com/hongyangAndroid/MPermissions</a></p>
<p>转自:<a href="http://blog.csdn.net/lmj623565791/article/details/50709663" target="_blank" rel="external">http://blog.csdn.net/lmj623565791/article/details/50709663</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/03/29/安卓代码动态切换APP启动图标/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="DavikChen">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/davikchen_pic.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="带刀大哥">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="带刀大哥" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/03/29/安卓代码动态切换APP启动图标/" itemprop="url">
                  安卓代码动态切换APP启动图标
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-03-29T13:45:34+08:00">
                2017-03-29
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <a href="/2017/03/29/安卓代码动态切换APP启动图标/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/03/29/安卓代码动态切换APP启动图标/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="安卓代码动态切换APP启动图标"><a href="#安卓代码动态切换APP启动图标" class="headerlink" title="安卓代码动态切换APP启动图标"></a>安卓代码动态切换APP启动图标</h2><h3 id="需要用到的知识：activity-alias"><a href="#需要用到的知识：activity-alias" class="headerlink" title="需要用到的知识：activity-alias"></a>需要用到的知识：activity-alias</h3><p>alias 英 [ˈeɪliəs] 美 [ˈeliəs, ˈeljəs]<br>n. 别名，化名;</p>
<p>顾名思义，activity-alias并不是代表一个Activity，而是代表一个已经存在的Activity的别名。<br>它使用在清单文件中，类似Activity标签。它可用来设置某个Activity的快捷入口</p>
<h3 id="activity-alias基本用法"><a href="#activity-alias基本用法" class="headerlink" title="activity-alias基本用法"></a>activity-alias基本用法</h3><p><activity-alias android:enabled="["true"" |="" "false"]="" android:exported="["true"" android:icon="drawable resource" android:label="string resource" android:name="string" android:permission="string" android:targetactivity="string"><br>    …<br></activity-alias></p>
<p>属性解释：</p>
<p>enabled    是否生效。配置多个activity-alias时，如果只想一个生效，就设置一个为true<br>exported    是否可以被其他应用调起，配置intent-filter时默认为true，未配置intent-filter时默认为false，只能被应用自身调起<br>icon    自定义生效时的icon<br>label    作用同Activity标签中的label属性，主要表现为桌面上的app名称和activity的title的名称<br>name    自定义生效时的icon<br>permission    指明通过别名声明调起目标Activity所必需的权限<br>targetActivity    指明目标Activity，类似于Activity标签中的name属性，需写明包类路径。表明通过activity-alias调起的是哪个Activity</p>
<p>代码示例:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">&lt;application</div><div class="line">    android:allowBackup=&quot;true&quot;</div><div class="line">    android:icon=&quot;@mipmap/ic_launcher&quot;</div><div class="line">    android:label=&quot;Android ICON&quot;</div><div class="line">    android:supportsRtl=&quot;true&quot;</div><div class="line">    android:theme=&quot;@style/AppTheme&quot;&gt;</div><div class="line">    &lt;activity android:name=&quot;.MainActivity&quot;&gt;</div><div class="line">        &lt;intent-filter&gt;</div><div class="line">            &lt;action android:name=&quot;android.intent.action.MAIN&quot; /&gt;</div><div class="line">            &lt;category android:name=&quot;android.intent.category.LAUNCHER&quot; /&gt;</div><div class="line">        &lt;/intent-filter&gt;</div><div class="line">    &lt;/activity&gt;</div><div class="line">    &lt;activity-alias</div><div class="line">        android:name=&quot;.MainAliasActivity&quot;</div><div class="line">        android:targetActivity=&quot;.MainActivity&quot;</div><div class="line">        android:label=&quot;UNIQLO ICON&quot;</div><div class="line">        android:icon=&quot;@mipmap/ic_launcher_change&quot;</div><div class="line">        android:enabled=&quot;false&quot;&gt;</div><div class="line">        &lt;intent-filter&gt;</div><div class="line">            &lt;action android:name=&quot;android.intent.action.MAIN&quot; /&gt;</div><div class="line">            &lt;category android:name=&quot;android.intent.category.LAUNCHER&quot; /&gt;</div><div class="line">        &lt;/intent-filter&gt;</div><div class="line">    &lt;/activity-alias&gt;</div><div class="line">&lt;/application&gt;</div></pre></td></tr></table></figure>
<p>这里声明了一个activity-alias，目标Activity为MainActivity，label为“UNIQLO ICON”，指定了一个与原icon不同的icon，目前未启用<br>我们在MainActivity中增加两个按钮，用于切换icon</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">// 切换icon</div><div class="line">changeIcon(&quot;com.hansion.changelaunchericon.MainAliasActivity&quot;);</div><div class="line"></div><div class="line">// 切换icon 方法</div><div class="line"> public void changeIcon(String activityPath) &#123;</div><div class="line">  PackageManager pm = getPackageManager();</div><div class="line">pm.setComponentEnabledSetting(getComponentName(),PackageManager.COMPONENT_ENABLED_STATE_DISABLED,PackageManager.DONT_KILL_APP);</div><div class="line">pm.setComponentEnabledSetting(new ComponentName(this, activityPath),</div><div class="line">PackageManager.COMPONENT_ENABLED_STATE_ENABLED, PackageManager.DONT_KILL_APP);</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这里虽然完成了 图标的切换 ，但实际情况是 我们需要从后端接口读取配置 来动态设置icon 。<br>后续再研究 。。。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/03/27/Android在一个APP中通过包名或类名启动另一个APP/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="DavikChen">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/davikchen_pic.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="带刀大哥">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="带刀大哥" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/03/27/Android在一个APP中通过包名或类名启动另一个APP/" itemprop="url">
                  Android在一个APP中通过包名或类名启动另一个APP
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-03-27T18:28:05+08:00">
                2017-03-27
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <a href="/2017/03/27/Android在一个APP中通过包名或类名启动另一个APP/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/03/27/Android在一个APP中通过包名或类名启动另一个APP/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Android在一个APP中通过包名或类名启动另一个APP"><a href="#Android在一个APP中通过包名或类名启动另一个APP" class="headerlink" title="Android在一个APP中通过包名或类名启动另一个APP"></a>Android在一个APP中通过包名或类名启动另一个APP</h2><p>开发有时需要在一个应用中启动另一个应用，比如Launcher加载所有的已安装的程序的列表，当点击图标时可以启动另一个应用。一般我们知道了另一个应用的包名和MainActivity的名字之后便可以直接通过如下代码来启动：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">Intent intent = new Intent(Intent.ACTION_MAIN);  </div><div class="line">intent.addCategory(Intent.CATEGORY_LAUNCHER);              </div><div class="line">ComponentName cn = new ComponentName(packageName, className);              </div><div class="line">intent.setComponent(cn);  </div><div class="line">startActivity(intent); </div><div class="line">``` </div><div class="line">但是更多的时候，我们一般都不知道目标应用程序的启动Activity的类名，而只知道包名，接下来就需要这么做了，我封装成了一个方法，如下所示</div></pre></td></tr></table></figure>
<p>private void doStartApplicationWithPackageName(String packagename) {</p>
<pre><code>    // 通过包名获取此APP详细信息，包括Activities、services、versioncode、name等等
    PackageInfo packageinfo = null;
    try {
        packageinfo = getPackageManager().getPackageInfo(packagename, 0);
    } catch (NameNotFoundException e) {
        e.printStackTrace();
    }
    if (packageinfo == null) {
        return;
    }

    // 创建一个类别为CATEGORY_LAUNCHER的该包名的Intent
    Intent resolveIntent = new Intent(Intent.ACTION_MAIN, null);
    resolveIntent.addCategory(Intent.CATEGORY_LAUNCHER);
    resolveIntent.setPackage(packageinfo.packageName);

    // 通过getPackageManager()的queryIntentActivities方法遍历
    List&lt;ResolveInfo&gt; resolveinfoList = getPackageManager()
            .queryIntentActivities(resolveIntent, 0);

    ResolveInfo resolveinfo = resolveinfoList.iterator().next();
    if (resolveinfo != null) {
        // packagename = 参数packname
        String packageName = resolveinfo.activityInfo.packageName;
        // 这个就是我们要找的该APP的LAUNCHER的Activity[组织形式：packagename.mainActivityname]
        String className = resolveinfo.activityInfo.name;
        // LAUNCHER Intent
        Intent intent = new Intent(Intent.ACTION_MAIN);
        intent.addCategory(Intent.CATEGORY_LAUNCHER);

        // 设置ComponentName参数1:packagename参数2:MainActivity路径
        ComponentName cn = new ComponentName(packageName, className);

        intent.setComponent(cn);
        startActivity(intent);
    }
}
</code></pre><p>```</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/03/27/Android开发之多线程编程简单例子/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="DavikChen">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/davikchen_pic.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="带刀大哥">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="带刀大哥" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/03/27/Android开发之多线程编程简单例子/" itemprop="url">
                  Android开发之多线程编程简单例子
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-03-27T18:23:07+08:00">
                2017-03-27
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <a href="/2017/03/27/Android开发之多线程编程简单例子/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/03/27/Android开发之多线程编程简单例子/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Android开发之多线程编程简单例子"><a href="#Android开发之多线程编程简单例子" class="headerlink" title="Android开发之多线程编程简单例子"></a>Android开发之多线程编程简单例子</h2><p>Android可有两种方式实现多线程，一种是继承Thread类，一种是实现Runnable接口；前者只要继承了Thread类同时覆写了本类中的run()方法就可以实现多线程操作了，但是Java中一个类只能继承一个父类，这是这种方式的局限性，后者只需要实现一个接口而已，Java中可以实现多个接口。</p>
<p>转自：<a href="http://blog.csdn.net/mad1989/article/details/38234759" target="_blank" rel="external">http://blog.csdn.net/mad1989/article/details/38234759</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/03/27/通过Parcelable协议传递数据出现错误/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="DavikChen">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/davikchen_pic.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="带刀大哥">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="带刀大哥" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/03/27/通过Parcelable协议传递数据出现错误/" itemprop="url">
                  通过Parcelable协议传递数据出现错误
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-03-27T17:56:36+08:00">
                2017-03-27
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <a href="/2017/03/27/通过Parcelable协议传递数据出现错误/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/03/27/通过Parcelable协议传递数据出现错误/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="通过Parcelable协议传递数据出现错误"><a href="#通过Parcelable协议传递数据出现错误" class="headerlink" title="通过Parcelable协议传递数据出现错误"></a>通过Parcelable协议传递数据出现错误</h2><p>转自:<a href="http://blog.csdn.net/mad1989/article/details/36295879" target="_blank" rel="external">http://blog.csdn.net/mad1989/article/details/36295879</a></p>
<p>自定义的数据类型需要implements Parcelable接口，并实现两个方法： describeContents和writeToParcel，还有一个最重要的CREATOR</p>
<p><strong>写&amp;读对象属性的顺序需要保持一致 。否则会出现异常。</strong></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/03/27/Android点击EditText文本框之外任何地方隐藏键盘的解决办法/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="DavikChen">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/davikchen_pic.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="带刀大哥">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="带刀大哥" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/03/27/Android点击EditText文本框之外任何地方隐藏键盘的解决办法/" itemprop="url">
                  Android点击EditText文本框之外任何地方隐藏键盘的解决办法
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-03-27T17:50:14+08:00">
                2017-03-27
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <a href="/2017/03/27/Android点击EditText文本框之外任何地方隐藏键盘的解决办法/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/03/27/Android点击EditText文本框之外任何地方隐藏键盘的解决办法/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Android点击EditText文本框之外任何地方隐藏键盘的解决办法"><a href="#Android点击EditText文本框之外任何地方隐藏键盘的解决办法" class="headerlink" title="Android点击EditText文本框之外任何地方隐藏键盘的解决办法"></a>Android点击EditText文本框之外任何地方隐藏键盘的解决办法</h2><p>1，实现方法一：通过给当前界面布局文件的父layout设置点击事件（相当于给整个Activity设置点击事件），在事件里进行键盘隐藏</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">@Override  </div><div class="line">public void onClick(View v) &#123;  </div><div class="line">    switch (v.getId()) &#123;  </div><div class="line">    case R.id.traceroute_rootview:  </div><div class="line">         InputMethodManager imm = (InputMethodManager)  </div><div class="line">         getSystemService(Context.INPUT_METHOD_SERVICE);  </div><div class="line">         imm.hideSoftInputFromWindow(v.getWindowToken(), 0);  </div><div class="line">        break;  </div><div class="line">    &#125;  </div><div class="line">  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>2，实现思路二：通过dispatchTouchEvent每次ACTION_DOWN事件中动态判断非EditText本身区域的点击事件，然后在事件中进行屏蔽。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">public  boolean isShouldHideInput(View v, MotionEvent event) &#123;</div><div class="line">		if (v != null &amp;&amp; (v instanceof EditText)) &#123;</div><div class="line">			int[] leftTop = &#123; 0, 0 &#125;;</div><div class="line">			//获取输入框当前的location位置</div><div class="line">			v.getLocationInWindow(leftTop);</div><div class="line">			int left = leftTop[0];</div><div class="line">			int top = leftTop[1];</div><div class="line">			int bottom = top + v.getHeight();</div><div class="line">			int right = left + v.getWidth();</div><div class="line">			if (event.getX() &gt; left &amp;&amp; event.getX() &lt; right</div><div class="line">					&amp;&amp; event.getY() &gt; top &amp;&amp; event.getY() &lt; bottom) &#123;</div><div class="line">				// 点击的是输入框区域，保留点击EditText的事件</div><div class="line">				return false;</div><div class="line">			&#125; else &#123;</div><div class="line">				return true;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		return false;</div><div class="line">	&#125;</div></pre></td></tr></table></figure>
<p>isShoudHideInput(View v,MotionEvent e)方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">public  boolean isShouldHideInput(View v, MotionEvent event) &#123;</div><div class="line">		if (v != null &amp;&amp; (v instanceof EditText)) &#123;</div><div class="line">			int[] leftTop = &#123; 0, 0 &#125;;</div><div class="line">			//获取输入框当前的location位置</div><div class="line">			v.getLocationInWindow(leftTop);</div><div class="line">			int left = leftTop[0];</div><div class="line">			int top = leftTop[1];</div><div class="line">			int bottom = top + v.getHeight();</div><div class="line">			int right = left + v.getWidth();</div><div class="line">			if (event.getX() &gt; left &amp;&amp; event.getX() &lt; right</div><div class="line">					&amp;&amp; event.getY() &gt; top &amp;&amp; event.getY() &lt; bottom) &#123;</div><div class="line">				// 点击的是输入框区域，保留点击EditText的事件</div><div class="line">				return false;</div><div class="line">			&#125; else &#123;</div><div class="line">				return true;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		return false;</div><div class="line">	&#125;</div></pre></td></tr></table></figure>
<p>两种方案都可行 主要还是看你的需求场景了。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/03/27/Java类的实例化-static-父类构造函数执行顺序/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="DavikChen">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/davikchen_pic.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="带刀大哥">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="带刀大哥" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/03/27/Java类的实例化-static-父类构造函数执行顺序/" itemprop="url">
                  Java类的实例化-static-父类构造函数执行顺序
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-03-27T17:39:09+08:00">
                2017-03-27
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <a href="/2017/03/27/Java类的实例化-static-父类构造函数执行顺序/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/03/27/Java类的实例化-static-父类构造函数执行顺序/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Java类的实例化、static、父类构造函数执行顺序"><a href="#Java类的实例化、static、父类构造函数执行顺序" class="headerlink" title="Java类的实例化、static、父类构造函数执行顺序"></a>Java类的实例化、static、父类构造函数执行顺序</h2><p>复习Java基础，以免自己以后犯原则性错误，这是最基本，最基础的东西。</p>
<p>A类:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">public class A &#123;</div><div class="line"></div><div class="line">	int a1 = 8;</div><div class="line">	int a2 = getA2();</div><div class="line">	&#123;</div><div class="line">		int a3 = 9;</div><div class="line">		System.out.println(&quot;top of A() a1=&quot; + a1 + &quot; a2=&quot; + a2 + &quot;  a3=&quot; + a3);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	public A() &#123;</div><div class="line">		this(66);</div><div class="line">		System.out.print(&quot;A 构造函数\n&quot;);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	&#123;</div><div class="line">		System.out.println(&quot;below A()..has start&quot;);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	public A(int num) &#123;</div><div class="line">		System.out.print(&quot;A 带参数构造函数: &quot; + num + &quot;\n&quot;);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	static &#123;</div><div class="line">		System.out.println(&quot;I`m a static &#123;&#125; from class A..&quot;);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	int getA2() &#123;</div><div class="line">		System.out.println(&quot;getA2..&quot;);</div><div class="line">		return 7;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	public void methodA() &#123;</div><div class="line">		System.out.println(&quot;methodA&quot;);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>B类:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line">public class B extends A &#123;</div><div class="line"></div><div class="line">	int b1 = 0;</div><div class="line">	int b2 = getB2();</div><div class="line">	&#123;</div><div class="line">		int b3 = 5;</div><div class="line">		System.out.println(&quot;top of B() b1=&quot; + b1 + &quot; b2=&quot; + b2 + &quot; b3=&quot; + b3);</div><div class="line"></div><div class="line">	&#125;</div><div class="line"></div><div class="line">	public B() &#123;</div><div class="line">		this(33);</div><div class="line">		// super(44);//添加super语句，会导致实例化时直接执行父类带参数的构造函数</div><div class="line">		System.out.print(&quot;B 构造函数\n&quot;);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	public B(int num) &#123;</div><div class="line">		// 添加super语句，会导致实例化时直接执行父类带参数的构造函数</div><div class="line">		// 前提是带参数的构造函数B会被运行（new实例化或this）</div><div class="line">		// super(77);</div><div class="line"></div><div class="line">		System.out.print(&quot;B 带参数构造函数:&quot; + num + &quot;\n&quot;);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	&#123;</div><div class="line">		System.out.println(&quot;below B()..has start&quot;);</div><div class="line">	&#125;</div><div class="line">	static &#123;</div><div class="line">		System.out.println(&quot;I`m a static &#123;&#125; from class B..&quot;);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	int getB2() &#123;</div><div class="line">		System.out.println(&quot;getB2..&quot;);</div><div class="line">		return 33;</div><div class="line"></div><div class="line">	&#125;</div><div class="line"></div><div class="line">	@Override</div><div class="line">	public void methodA() &#123;</div><div class="line">		System.out.println(&quot;methoaA int class B&quot;);</div><div class="line">		super.methodA();</div><div class="line"></div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>main 类:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">public class mymain &#123;</div><div class="line"></div><div class="line">	public static void main(String[] args) &#123;</div><div class="line">		// TODO Auto-generated method stub</div><div class="line">		System.out.println(&quot;main app run..&quot;);</div><div class="line">		B b = new B();</div><div class="line">//		B b = new B(22);</div><div class="line">		b.methodA();</div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>实验一</p>
<p>思考一下打印输出的顺序？</p>
<p>打印输出结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">main app run..</div><div class="line">I`m a static &#123;&#125; from class A..</div><div class="line">I`m a static &#123;&#125; from class B..</div><div class="line">getA2..</div><div class="line">top of A() a1=8 a2=7  a3=9</div><div class="line">below A()..has start</div><div class="line">A 带参数构造函数: 66</div><div class="line">A 构造函数</div><div class="line">getB2..</div><div class="line">top of B() b1=0 b2=33 b3=5</div><div class="line">below B()..has start</div><div class="line">B 带参数构造函数:33</div><div class="line">B 构造函数</div><div class="line">methoaA int class B</div><div class="line">methodA</div></pre></td></tr></table></figure>
<p>分析：B类无参的构造函数中的this语句并没有影响到父类A类的构造函数执行顺序</p>
<p>实验二</p>
<p>如果我把B类无参数的构造函数，this(33)换成super(44)呢，看一下结果？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">main app run..</div><div class="line">I`m a static &#123;&#125; from class A..</div><div class="line">I`m a static &#123;&#125; from class B..</div><div class="line">getA2..</div><div class="line">top of A() a1=8 a2=7  a3=9</div><div class="line">below A()..has start</div><div class="line">A 带参数构造函数: 44</div><div class="line">getB2..</div><div class="line">top of B() b1=0 b2=33 b3=5</div><div class="line">below B()..has start</div><div class="line">B 构造函数</div><div class="line">methoaA int class B</div><div class="line">methodA</div></pre></td></tr></table></figure>
<p>分析：B类无参构造函数中的super语句直接影响了父类（A类）构造函数的执行顺序，由于super(44)指向了父类带参数的构造函数，造成实例化时，只执行了父类带参数的构造函数，由此看出，super语句的有与无，对父类带参/不带参的构造函数是有影响的。</p>
<p>实验三</p>
<p>如果B类无参数的构造函数，如一开始那样this(33)保留，super去掉；但是B类带参数的构造函数添加 super(77)语句，结果又会是什么呢？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">main app run..</div><div class="line">I`m a static &#123;&#125; from class A..</div><div class="line">I`m a static &#123;&#125; from class B..</div><div class="line">getA2..</div><div class="line">top of A() a1=8 a2=7  a3=9</div><div class="line">below A()..has start</div><div class="line">A 带参数构造函数: 77</div><div class="line">getB2..</div><div class="line">top of B() b1=0 b2=33 b3=5</div><div class="line">below B()..has start</div><div class="line">B 带参数构造函数:33</div><div class="line">B 构造函数</div><div class="line">methoaA int class B</div><div class="line">methodA</div></pre></td></tr></table></figure>
<p>分析：B类带参数的构造函数中的super(77)，又影响了父类构造函数的执行顺序，导致父类没有执行无参的构造函数，这一切都是因为有super语句！但是请记住，因为实例化B类无参的构造函数中有一句：this(33)，使编译器看到了B类带参数构造函数中的super语句。假如说，没有this(33)语句，并且B类new时并没有new到带参数的构造函数，此时编译器并不会查找到super语句，也就继续执行父类无参的构造函数，就像实验一的结果一样。</p>
<p><strong>综合结论：</strong><br>一个类的实例化过程：<br>1，首先会执行类中static代码块(不管代码块是否在类的开头还是末尾处)，如果这个类有父类，同样会优先查找父类中的static代码块，然后是当前类的static。</p>
<p>2，然后会从父类的第一行开始执行，直至代码末尾处，中间不管是有赋值还是method调用，都会按顺序一一执行（method），普通代码块{ }…</p>
<p>3，其次才是父类的构造函数，执行带参数或不带参数的构造函数，依赖于实例化的类的构造函数有没有super父类的带参或不带参的构造函数，上边试验二三已经证明。</p>
<p>4，然后会从子类（当前类）的第一行开始执行，直至代码末尾处，中间不管是有赋值还是method调用，都会按顺序一一执行（method），普通代码块{ }…</p>
<p>5，其次会是子类（当前类）的构造函数，按顺序执行。</p>
<p>6，最后是类方法的调用执行，如果子类覆盖了父类的method，执行时会先执行子类覆盖的method，method内如果有super.method()，才会调用父类的同名method，否则不会。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/03/27/Android客户端和服务器以TCP/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="DavikChen">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/davikchen_pic.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="带刀大哥">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="带刀大哥" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/03/27/Android客户端和服务器以TCP/" itemprop="url">
                  Android客户端和服务器以TCP
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-03-27T17:05:57+08:00">
                2017-03-27
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <a href="/2017/03/27/Android客户端和服务器以TCP/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/03/27/Android客户端和服务器以TCP/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Socket-通信原理-Android客户端和服务器以TCP-amp-amp-UDP方式互通"><a href="#Socket-通信原理-Android客户端和服务器以TCP-amp-amp-UDP方式互通" class="headerlink" title="Socket 通信原理(Android客户端和服务器以TCP&amp;&amp;UDP方式互通)"></a>Socket 通信原理(Android客户端和服务器以TCP&amp;&amp;UDP方式互通)</h2><p>转自:<a href="http://blog.csdn.net/mad1989/article/details/9147661" target="_blank" rel="external">http://blog.csdn.net/mad1989/article/details/9147661</a></p>
<h4 id="一、Socket通信简介"><a href="#一、Socket通信简介" class="headerlink" title="一、Socket通信简介"></a>一、Socket通信简介</h4><p>Android与服务器的通信方式主要有两种，一是Http通信，一是Socket通信。两者的最大差异在于，http连接使用的是“请求—响应方式”，即在请求时建立连接通道，当客户端向服务器发送请求后，服务器端才能向客户端返回数据。而Socket通信则是在双方建立起连接后就可以直接进行数据的传输，在连接时可实现信息的主动推送，而不需要每次由客户端想服务器发送请求。 那么，什么是socket？Socket又称套接字，在程序内部提供了与外界通信的端口，即端口通信。通过建立socket连接，可为通信双方的数据传输传提供通道。socket的主要特点有数据丢失率低，使用简单且易于移植。</p>
<p><strong>1.1什么是Socket Socket</strong><br>是一种抽象层，应用程序通过它来发送和接收数据，使用Socket可以将应用程序添加到网络中，与处于同一网络中的其他应用程序进行通信。简单来说，Socket提供了程序内部与外界通信的端口并为通信双方的提供了数据传输通道。</p>
<p><strong>1.2Socket的分类</strong><br>根据不同的的底层协议，Socket的实现是多样化的。本指南中只介绍TCP/IP协议族的内容，在这个协议族当中主要的Socket类型为流套接字（streamsocket）和数据报套接字(datagramsocket)。流套接字将TCP作为其端对端协议，提供了一个可信赖的字节流服务。数据报套接字使用UDP协议，提供数据打包发送服务。 下面，我们来认识一下这两种Socket类型的基本实现模型。</p>
<h4 id="Socket基本实现原理"><a href="#Socket基本实现原理" class="headerlink" title="Socket基本实现原理"></a>Socket基本实现原理</h4><p><strong>3.1基于TCP协议的Socket</strong><br>服务器端首先声明一个ServerSocket对象并且指定端口号，然后调用Serversocket的accept（）方法接收客户端的数据。accept（）方法在没有数据进行接收的处于堵塞状态。（Socketsocket=serversocket.accept()）,一旦接收到数据，通过inputstream读取接收的数据。<br>  客户端创建一个Socket对象，指定服务器端的ip地址和端口号（Socketsocket=newSocket(“172.168.10.108”,8080);）,通过inputstream读取数据，获取服务器发出的数据（OutputStreamoutputstream=socket.getOutputStream()），最后将要发送的数据写入到outputstream即可进行TCP协议的socket数据传输。</p>
<p><strong>3.2基于UDP协议的数据传输</strong></p>
<p>服务器端首先创建一个DatagramSocket对象，并且指点监听的端口。接下来创建一个空的DatagramSocket对象用于接收数据（bytedata[]=newbyte[1024;]DatagramSocketpacket=newDatagramSocket（data，data.length））,使用DatagramSocket的receive方法接收客户端发送的数据，receive（）与serversocket的accepet（）类似，在没有数据进行接收的处于堵塞状态。<br>客户端也创建个DatagramSocket对象，并且指点监听的端口。接下来创建一个InetAddress对象，这个对象类似与一个网络的发送地址（InetAddressserveraddress=InetAddress.getByName（”172.168.1.120”））.定义要发送的一个字符串，创建一个DatagramPacket对象，并制定要讲这个数据报包发送到网络的那个地址以及端口号，最后使用DatagramSocket的对象的send（）发送数据。*（Stringstr=”hello”;bytedata[]=str.getByte();DatagramPacketpacket=new DatagramPacket(data,data.length,serveraddress,4567);socket.send(packet);）</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/03/27/Android-Service保活常见处理/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="DavikChen">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/davikchen_pic.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="带刀大哥">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="带刀大哥" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/03/27/Android-Service保活常见处理/" itemprop="url">
                  Android-Service保活常见处理
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-03-27T16:26:05+08:00">
                2017-03-27
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <a href="/2017/03/27/Android-Service保活常见处理/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/03/27/Android-Service保活常见处理/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Android-Service保活常见处理"><a href="#Android-Service保活常见处理" class="headerlink" title="Android-Service保活常见处理"></a>Android-Service保活常见处理</h2><p>转自：<a href="http://blog.csdn.net/mad1989/article/details/22492519" target="_blank" rel="external">http://blog.csdn.net/mad1989/article/details/22492519</a></p>
<h3 id="Service简介"><a href="#Service简介" class="headerlink" title="Service简介"></a>Service简介</h3><p>Service是在一段不定的时间运行在后台，不和用户交互应用组件。每个Service必须在manifest中 通过<service>来声明。可以通过contect.startservice和contect.bindserverice来启动。和其他的应用组件一样，运行在进程的主线程中。这就是说如果service需要很多耗时或者阻塞的操作，需要在其子线程中实现（或者用系统提供的IntentService，它继承了Service，它处理数据是用自身新开的线程）。【当然你也可以在新的线程中startService，这样Service就不是在MainThread了】</service></p>
<p>本地服务 Local Service 用于应用程序内部<br>它可以启动并运行，直至有人停止了它或它自己停止。在这种方式下，它以调用Context.startService()启动，而以调用Context.stopService()结束。它可以调用Service.stopSelf() 或 Service.stopSelfResult()来自己停止。不论调用了多少次startService()方法，你只需要调用一次stopService()来停止服务。<br>【用于实现应用程序自己的一些耗时任务，比如查询升级信息，并不占用应用程序比如Activity所属线程，而是单开线程后台执行，这样用户体验比较好】</p>
<p>远程服务 Remote Service 用于Android系统内部的应用程序之间<br>它可以通过自己定义并暴露出来的接口进行程序操作。客户端建立一个到服务对象的连接，并通过那个连接来调用服务。连接以调用Context.bindService()方法建立，以调用 Context.unbindService()关闭。多个客户端可以绑定至同一个服务。如果服务此时还没有加载，bindService()会先加载它。<br>【可被其他应用程序复用，比如天气预报服务，其他应用程序不需要再写这样的服务，调用已有的即可】</p>
<h4 id="Service的生命周期"><a href="#Service的生命周期" class="headerlink" title="Service的生命周期"></a>Service的生命周期</h4><h4 id="Service运行方式"><a href="#Service运行方式" class="headerlink" title="Service运行方式"></a>Service运行方式</h4><p>以startService()启动服务，系统将通过传入的Intent在底层搜索相关符合Intent里面信息的service。如果服务没有启动则先运行onCreate，然后运行onStartCommand （可在里面处理启动时传过来的Intent和其他参数），直到明显调用stopService或者stopSelf才将停止Service。无论运行startService多少次，只要调用一次stopService或者stopSelf，Service都会停止。使用stopSelf(int)方法可以保证在处理好intent后再停止。onStartCommand ，在2.0后被引入用于service的启动函数，2.0之前为public void onStart(Intent intent, int startId) 。<br>以bindService()方法启用服务，调用者与服务绑定在了一起，调用者一旦退出，服务也就终止。onBind()只有采用Context.bindService()方法启动服务时才会回调该方法。该方法在调用者与服务绑定时被调用，当调用者与服务已经绑定，多次调用Context.bindService()方法并不会导致该方法被多次调用。采用Context.bindService()方法启动服务时只能调用onUnbind()方法解除调用者与服务解除，服务结束时会调用onDestroy()方法。</p>
<p>3，拥有service的进程具有较高的优先级<br>官方文档告诉我们，Android系统会尽量保持拥有service的进程运行，只要在该service已经被启动(start)或者客户端连接(bindService)到它。当内存不足时，需要保持，拥有service的进程具有较高的优先级。<br>1． 如果service正在调用onCreate,onStartCommand或者onDestory方法，那么用于当前service的进程则变为前台进程以避免被killed。<br>2． 如果当前service已经被启动(start)，拥有它的进程则比那些用户可见的进程优先级低一些，但是比那些不可见的进程更重要，这就意味着service一般不会被killed.<br>3． 如果客户端已经连接到service (bindService),那么拥有Service的进程则拥有最高的优先级，可以认为service是可见的。<br>4． 如果service可以使用startForeground(int, Notification)方法来将service设置为前台状态，那么系统就认为是对用户可见的，并不会在内存不足时killed。<br>5． 如果有其他的应用组件作为Service,Activity等运行在相同的进程中，那么将会增加该进程的重要性。</p>
<p>保证service不被杀掉</p>
<p>onStartCommand方法，返回START_STICKY</p>
<p>StartCommond几个常量参数简介：<br>1、START_STICKY<br>在运行onStartCommand后service进程被kill后，那将保留在开始状态，但是不保留那些传入的intent。不久后service就会再次尝试重新创建，因为保留在开始状态，在创建     service后将保证调用onstartCommand。如果没有传递任何开始命令给service，那将获取到null的intent。<br>2、START_NOT_STICKY<br>在运行onStartCommand后service进程被kill后，并且没有新的intent传递给它。Service将移出开始状态，并且直到新的明显的方法（startService）调用才重新创建。因为如果没有传递任何未决定的intent那么service是不会启动，也就是期间onstartCommand不会接收到任何null的intent。<br>3、START_REDELIVER_INTENT<br>在运行onStartCommand后service进程被kill后，系统将会再次启动service，并传入最后一个intent给onstartCommand。直到调用stopSelf(int)才停止传递intent。如果在被kill后还有未处理好的intent，那被kill后服务还是会自动启动。因此onstartCommand不会接收到任何null的intent。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">@Override  </div><div class="line">public int onStartCommand(Intent intent, int flags, int startId) &#123;  </div><div class="line">    flags = START_STICKY;  </div><div class="line">    return super.onStartCommand(intent, flags, startId);  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>【结论】 手动返回START_STICKY，亲测当service因内存不足被kill，当内存又有的时候，service又被重新创建，比较不错，但是不能保证任何情况下都被重建，比如进程被干掉了….</p>
<p>提升service优先级</p>
<p>在AndroidManifest.xml文件中对于intent-filter可以通过android:priority = “1000”这个属性设置最高优先级，1000是最高值，如果数字越小则优先级越低，同时适用于广播。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&lt;service  </div><div class="line">    android:name=&quot;com.dbjtech.acbxt.waiqin.UploadService&quot;  </div><div class="line">    android:enabled=&quot;true&quot; &gt;  </div><div class="line">    &lt;intent-filter android:priority=&quot;1000&quot; &gt;  </div><div class="line">        &lt;action android:name=&quot;com.dbjtech.myservice&quot; /&gt;  </div><div class="line">    &lt;/intent-filter&gt;  </div><div class="line">&lt;/service&gt;</div></pre></td></tr></table></figure>
<p>【结论】目前看来，priority这个属性貌似只适用于broadcast，对于Service来说可能无效</p>
<p>提升service进程优先级</p>
<p>Android中的进程是托管的，当系统进程空间紧张的时候，会依照优先级自动进行进程的回收。Android将进程分为6个等级,它们按优先级顺序由高到低依次是:<br>   1.前台进程( FOREGROUND_APP)<br>   2.可视进程(VISIBLE_APP )</p>
<ol>
<li>次要服务进程(SECONDARY_SERVER )<br>4.后台进程 (HIDDEN_APP)<br>5.内容供应节点(CONTENT_PROVIDER)<br>6.空进程(EMPTY_APP)<br>当service运行在低内存的环境时，将会kill掉一些存在的进程。因此进程的优先级将会很重要，可以使用startForeground 将service放到前台状态。这样在低内存时被kill的几率会低一些。</li>
</ol>
<p>在onStartCommand方法内添加如下代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">Notification notification = new Notification(R.drawable.ic_launcher,  </div><div class="line"> getString(R.string.app_name), System.currentTimeMillis());  </div><div class="line">  </div><div class="line"> PendingIntent pendingintent = PendingIntent.getActivity(this, 0,  </div><div class="line"> new Intent(this, AppMain.class), 0);  </div><div class="line"> notification.setLatestEventInfo(this, &quot;uploadservice&quot;, &quot;请保持程序在后台运行&quot;,  </div><div class="line"> pendingintent);  </div><div class="line"> startForeground(0x111, notification);</div></pre></td></tr></table></figure>
<p>Application加上Persistent属性</p>
<p>看Android的文档知道，当进程长期不活动，或系统需要资源时，会自动清理门户，杀死一些Service，和不可见的Activity等所在的进程。但是如果某个进程不想被杀死（如数据缓存进程，或状态监控进程，或远程服务进程），可以这么做：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&lt;application  </div><div class="line">    android:name=&quot;com.test.Application&quot;  </div><div class="line">    android:allowBackup=&quot;true&quot;  </div><div class="line">    android:icon=&quot;@drawable/ic_launcher&quot;  </div><div class="line">    android:label=&quot;@string/app_name&quot;  </div><div class="line">   &lt;span style=&quot;color:#ff0000;&quot;&gt; android:persistent=&quot;true&quot;&lt;/span&gt;  </div><div class="line">    android:theme=&quot;@style/AppTheme&quot; &gt;  </div><div class="line">&lt;/application&gt;</div></pre></td></tr></table></figure>
<p>【结论】据说这个属性不能乱设置，不过设置后，的确发现优先级提高不少，或许是相当于系统级的进程，但是还是无法保证存活</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/4/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><span class="space">&hellip;</span><a class="page-number" href="/page/10/">10</a><a class="extend next" rel="next" href="/page/6/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/davikchen_pic.jpg"
               alt="DavikChen" />
          <p class="site-author-name" itemprop="name">DavikChen</p>
          <p class="site-description motion-element" itemprop="description">记录在工作中遇到的各种技术问题</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">96</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">67</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">DavikChen</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.0"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"davikchen"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    
    <script src="/lib/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  








  
  

  

  

  

  


</body>
</html>
